<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¹¸ç¦æŸ‘ä»”åº— - AD8æª¢æ¸¬ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body { 
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%; margin: 0; padding: 0; 
            background-color: #2d3748; font-family: 'Noto Sans TC', sans-serif; 
            overflow: hidden; overscroll-behavior: none; 
        }

        #mobile-container {
            width: 100%; height: 100%; max-width: 480px; margin: 0 auto; 
            background: #000; position: relative; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* èƒŒæ™¯èˆ‡è§’è‰²å±¤ */
        #bg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 0.5s ease; background-color: #333; z-index: 1;
        }

        #char-container {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }
        .char-img {
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            max-height: 85%; width: auto; max-width: 95%; opacity: 0; 
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4));
            transition: opacity 0.3s ease-in-out; 
            /* æ–°å¢ï¼šè®“è§’è‰²æˆ–ç‰©ä»¶å¯ä»¥ç›´æ¥è¢«é»æ“Š */
            pointer-events: auto;
            cursor: pointer;
        }
        .char-visible { opacity: 1 !important; }
        
        /* ç‰¹æ®Šä½ç½®èª¿æ•´ */
        .object-mode { bottom: 25% !important; max-height: 45% !important; }
        .calendar-pos { bottom: 45% !important; max-height: 32% !important; }
        .phone-pos { bottom: 30% !important; max-height: 45% !important; transform: translateX(-50%) scale(0.7) !important; }

        /* HUD */
        #top-hud {
            position: absolute; top: 15px; left: 15px; right: 15px;
            display: flex; justify-content: space-between; pointer-events: none; z-index: 20;
        }
        .status-pill {
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            padding: 8px 16px; border-radius: 25px; font-size: 16px; font-weight: bold;
            border: 1px solid rgba(255,255,255,0.2); color: white; display: flex; align-items: center; gap: 8px;
        }

        #music-toggle {
            position: absolute; top: 15px; right: 15px; z-index: 50;
            width: 44px; height: 44px; border-radius: 50%;
            background: rgba(0,0,0,0.6); border: 2px solid #fff;
            color: white; font-size: 20px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; pointer-events: auto;
        }

        /* å°è©±æ¡† */
        #dialog-area {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 38%;
            background: linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0.9) 75%, rgba(0,0,0,0) 100%);
            padding: 25px; padding-top: 50px; color: white; z-index: 30;
            display: flex; flex-direction: column; cursor: pointer;
        }
        #speaker-box {
            align-self: flex-start; background: #f6ad55; color: #2d3748;
            padding: 6px 18px; border-radius: 8px; font-weight: bold; font-size: 20px; margin-bottom: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); transform: translateY(-5px);
            display: flex; align-items: center; gap: 10px; white-space: nowrap;
        }
        #dialog-text { 
            font-size: 22px; line-height: 1.6; flex: 1; overflow-y: auto; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.8); white-space: pre-wrap; word-break: break-all;
        }
        .next-arrow { position: absolute; bottom: 25px; right: 25px; color: #f6ad55; animation: bounce 1s infinite; font-size: 28px; }

        /* äº’å‹•å±¤ */
        #interaction-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            z-index: 100; display: none;
            flex-direction: column; justify-content: center; align-items: center; padding: 25px;
        }
        #interaction-title {
            color: white; font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 30px;
            background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; width: 100%;
            border: 1px solid rgba(255,255,255,0.2); display: flex; justify-content: space-between; align-items: center;
        }
        #interaction-content { width: 100%; display: flex; flex-direction: column; align-items: center; }

        /* å„ªåŒ–å¾Œçš„é¸é …æŒ‰éˆ• */
        .choice-btn {
            background: white !important; color: #2d3748 !important; width: 100%; 
            min-height: 70px; padding: 10px 20px; margin-bottom: 16px;
            border-radius: 50px; border: none; font-size: 20px; font-weight: bold;
            box-shadow: 0 4px 0 #cbd5e0; transition: transform 0.1s;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
            flex-shrink: 0;
            touch-action: manipulation; /* é˜²é›™æ“Šæ”¾å¤§ */
            user-select: none;
            -webkit-user-select: none;
        }
        .choice-btn:active { transform: translateY(4px); box-shadow: none; background: #e2e8f0 !important; }
        
        /* é¸é …å…§çš„æœ—è®€æŒ‰éˆ• */
        .opt-speak-btn {
            background: #f6ad55; color: white;
            width: 44px; height: 44px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin-right: 15px; flex-shrink: 0; cursor: pointer;
            box-shadow: 0 2px 0 #dd6b20;
        }
        .opt-speak-btn:active { transform: scale(0.95); box-shadow: none; }

        /* è¼¸å…¥ä»‹é¢ */
        .input-group { display: flex; gap: 8px; margin-bottom: 25px; width: 100%; justify-content: center; }
        .custom-select { padding: 12px 4px; font-size: 18px; border-radius: 10px; border: 3px solid #f6ad55; background: #fff; color: #2d3748; font-weight: bold; text-align: center; flex: 1; min-width: 0; }
        .confirm-btn { background: #48bb78 !important; color: white !important; padding: 18px 40px; border-radius: 50px; font-size: 24px; font-weight: bold; border: none; cursor: pointer; box-shadow: 0 6px 0 #2f855a; width: 100%; margin-top: 15px; touch-action: manipulation; }

        /* Numpad & TimePicker */
        #numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 100%; margin-bottom: 15px; }
        .num-btn { 
            background: rgba(255,255,255,0.15); color: white; border: 2px solid rgba(255,255,255,0.3); 
            padding: 18px; font-size: 26px; font-weight: bold; border-radius: 12px; cursor: pointer;
            touch-action: manipulation; /* é˜²é›™æ“Šæ”¾å¤§ */
            user-select: none;
            -webkit-user-select: none;
        }
        .num-btn:active { background: rgba(255,255,255,0.4); }
        .del-btn { color: #feb2b2; }
        #numpad-display { width: 100%; background: #fff; color: #2d3748; font-size: 40px; font-weight: bold; text-align: center; padding: 12px; border-radius: 12px; margin-bottom: 20px; border: 4px solid #f6ad55; letter-spacing: 3px; height: 85px; display: flex; align-items: center; justify-content: center; user-select: none; }

        .time-picker-container { display: flex; flex-direction: column; align-items: center; width: 100%; background: white; border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ampm-toggle { display: flex; background: #e2e8f0; border-radius: 50px; padding: 5px; margin-bottom: 20px; width: 100%; }
        .ampm-btn { flex: 1; padding: 12px; border-radius: 40px; border: none; font-size: 20px; font-weight: bold; cursor: pointer; background: transparent; color: #718096; touch-action: manipulation; user-select: none; }
        .ampm-btn.active { background: #3b82f6; color: white; }
        .hour-selector { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%; }
        .hour-btn { background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 15px 0; font-size: 22px; font-weight: bold; color: #2d3748; cursor: pointer; touch-action: manipulation; user-select: none; }
        .hour-btn.selected { border-color: #f6ad55; background: #fffaf0; color: #ed8936; box-shadow: 0 0 0 2px #f6ad55; }

        /* Report */
        #report-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; text-align: center; color: white; }
        .report-card { background: #fff; width: 100%; padding: 35px 25px; border-radius: 25px; box-shadow: 0 10px 50px rgba(0,0,0,0.8); text-align: center; color: #2d3748; }
        .stamp { border: 5px solid #e53e3e; color: #e53e3e; border-radius: 15px; padding: 10px 25px; font-size: 32px; font-weight: bold; transform: rotate(-5deg); margin: 30px auto; display: inline-block; }
        
        /* ç”¨æˆ¶è³‡æ–™è¼¸å…¥æ¡†æ¨£å¼ */
        .user-input {
            width: 80%; padding: 15px; margin-bottom: 15px; border-radius: 50px;
            border: 2px solid #f6ad55; font-size: 18px; text-align: center;
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }
    </style>
</head>
<body>

    <div id="mobile-container">
        <audio id="bgMusic" loop preload="auto"><source src="assets/audio/bgm.mp3" type="audio/mpeg"></audio>

        <div id="music-toggle" onclick="toggleMusic()">
            <i class="fas fa-volume-up"></i>
        </div>

        <div id="bg-layer"></div>
        
        <div id="char-container">
            <img id="char-1" class="char-img" alt="C1" onclick="advanceStory()">
            <img id="char-2" class="char-img" alt="C2" onclick="advanceStory()">
        </div>
        
        <img id="key-item" style="position:absolute; top:52%; left:62%; width:160px; padding:30px; display:none; z-index:15; cursor:pointer; touch-action: manipulation;" src="assets/images/key.png" alt="Key">
        
        <div id="top-hud">
            <div class="status-pill"><i class="fas fa-clock"></i> <span id="game-time">08:00</span></div>
            <div class="status-pill" style="margin-right: 50px;"><i class="fas fa-coins"></i> ç‡Ÿæ”¶: <span id="game-money">0</span></div>
        </div>
        
        <div id="dialog-area" onclick="advanceStory()">
            <div id="speaker-box">
                <span id="speaker-name">...</span>
                <div class="read-btn" onclick="event.stopPropagation(); replayVoice()"><i class="fas fa-volume-up"></i></div>
            </div>
            <div id="dialog-text">...</div>
            <div class="next-arrow"><i class="fas fa-caret-down"></i></div>
        </div>
        
        <div id="interaction-overlay">
            <div id="interaction-title">
                <span id="title-text">è«‹é¸æ“‡</span>
                <div class="title-speak-btn" style="background: rgba(255,255,255,0.2); width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="speakTitle()"><i class="fas fa-volume-up"></i></div>
            </div>
            <div id="interaction-content"></div>
        </div>

        <div id="intro-overlay" style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:200; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px; text-align:center; color:white;">
            <div style="font-size: 40px; font-weight: bold; color: #f6ad55; margin-bottom: 25px;">å¹¸ç¦æŸ‘ä»”åº—</div>
            <div style="font-size:18px; line-height:1.6; color:#e2e8f0; margin-bottom:30px;">
                æ­¡è¿å…‰è‡¨ï¼ä»Šå¤©æ‚¨å°‡åŒ–èº«ç‚º<b>ã€Œä¸€æ—¥åº—é•·ã€</b>ã€‚<br>é–‹å§‹å‰ï¼Œè«‹è¼¸å…¥æ‚¨çš„åŸºæœ¬è³‡æ–™ï¼š
            </div>
            
            <input type="text" id="user-name" class="user-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å/æš±ç¨±">
            <input type="number" id="user-age" class="user-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¹´é½¡">

            <button id="start-btn" onclick="startGame()" disabled style="background: linear-gradient(135deg, #f6ad55, #ed8936); color: #fff; border: none; padding: 18px 70px; border-radius: 50px; font-size: 24px; font-weight: bold; cursor: pointer; transition: 0.3s; opacity: 0.7; margin-top: 20px;">éŠæˆ²è¼‰å…¥ä¸­...</button>
        </div>
        
        <div id="report-overlay" style="display:none;">
            <div class="report-card">
                <h2 style="margin:0;">ğŸ“… æœ¬æ—¥ç‡Ÿé‹æ—¥å ±</h2>
                <div id="final-stamp" class="stamp">é‡‘ç‰Œåº—é•·</div>
                <div style="display:flex; justify-content:space-between; border-bottom:1px dashed #ccc; padding:15px 0;">
                    <span>ç‡Ÿé‹ç©åˆ†</span><span id="report-money" style="font-weight:bold; color:#38a169; font-size:22px;">$0</span>
                </div>
                <div style="display:flex; justify-content:space-between; border-bottom:1px dashed #ccc; padding:15px 0;">
                    <span>å°ˆæ³¨åŠ›è©•ç´š</span><span id="report-risk" style="font-weight:bold; font-size:22px;">S ç´š</span>
                </div>
                <p id="report-advice" style="font-size:18px; margin-top:25px; text-align:left; background:#f7fafc; padding:20px; border-radius:15px; line-height:1.6;">...</p>
                <div id="saving-status" style="font-size:14px; color:gray; margin-top:10px;">è³‡æ–™å„²å­˜ä¸­...</div>
            </div>
            <button onclick="location.reload()" style="background:#4fd1c5; color:white; border:none; padding:18px 50px; border-radius:50px; font-size:22px; font-weight:bold; margin-top:30px; cursor:pointer;">æ˜æ—¥ç¹¼çºŒç‡Ÿæ¥­</button>
        </div>
    </div>

    <script>
        // ================= FIREBASE è¨­å®šèˆ‡é‚è¼¯ =================
        
        const firebaseConfig = {
            apiKey: "AIzaSyB6wcFs5gSiNDCSweKcEzgRpbIAAb5I3Vo",
            authDomain: "smart-squat-health.firebaseapp.com",
            projectId: "smart-squat-health",
            storageBucket: "smart-squat-health.firebasestorage.app",
            messagingSenderId: "475970550783",
            appId: "1:475970550783:web:2d7dcacb2e55b562eb05ca",
        };

        // åˆå§‹åŒ– Firebase
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            console.log("Firebase initialized");
        } catch (e) {
            console.error("Firebase init error:", e);
        }

        let userData = {
            name: "",
            age: 0,
            startTime: null,
            logs: []
        };

        function saveGameRecord(finalRisk, finalMoney) {
            if(!db) return;
            const statusEl = document.getElementById('saving-status');
            
            db.collection("game_records").add({
                name: userData.name,
                age: userData.age,
                date: new Date(),
                riskScore: finalRisk,
                totalMoney: finalMoney,
                details: userData.logs,
                platform: navigator.userAgent
            })
            .then((docRef) => {
                console.log("Document written with ID: ", docRef.id);
                statusEl.innerText = "âœ… æ¸¬é©—çµæœå·²é›²ç«¯å‚™ä»½";
                statusEl.style.color = "green";
            })
            .catch((error) => {
                console.error("Error adding document: ", error);
                statusEl.innerText = "âš ï¸ è³‡æ–™å„²å­˜å¤±æ•— (è«‹æª¢æŸ¥ç¶²è·¯)";
                statusEl.style.color = "red";
            });
        }

        // ================= åŸæœ‰éŠæˆ²é‚è¼¯ =================

        const ASSETS = {
            bg_morning: "assets/images/store-day.jpg",
            bg_noon: "assets/images/store-day.jpg",
            bg_evening: "assets/images/store-dusk.jpg",
            bg_night: "assets/images/store-night.jpg",
            bg_desktop: "assets/images/desktop.jpg",
            char_oldman: "assets/images/wang.png",
            char_delivery: "assets/images/deliveryboy.png",
            char_customer: "assets/images/mrschen.png", 
            char_tv: "assets/images/tv.png",
            char_keys: "assets/images/key.png",
            char_phone: "assets/images/phone.png", 
            char_clock: "assets/images/calendar.png" 
        };

        const VOICE_PROFILES = {
            "åº—é•·": { pitch: 1.0, rate: 1.0 },
            "æ—ç™½": { pitch: 1.0, rate: 1.1 },
            "è‚‰è²©å°åŠ‰": { pitch: 1.5, rate: 1.4 }, 
            "ç±³åº—é˜¿å¼·": { pitch: 0.7, rate: 1.2 },
            "è€ç‹": { pitch: 0.6, rate: 0.8 }, 
            "é™³å¤ªå¤ª": { pitch: 1.4, rate: 1.1 }
        };

        const SCRIPT = [
            { type: "scene", bg: "bg_morning", time: "08:00" },
            { type: "talk", speaker: "åº—é•·", text: "æ—©å®‰ï¼åˆæ˜¯å……æ»¿æ´»åŠ›çš„ä¸€å¤©ã€‚" },
            { type: "talk", speaker: "åº—é•·", text: "é¦–å…ˆè¦æŠŠæ—¥æ›†æ’•åˆ°ä»Šå¤©... å’¦ï¼Ÿä»Šå¤©æ˜¯å¹¾è™Ÿï¼Ÿ", char: "char_clock" },
            { type: "date_input", text: "è«‹é¸æ“‡ä»Šæ—¥çš„æ­£ç¢ºæ—¥æœŸï¼š", char: "char_clock", qId: "Q1_Date",
              correct: { money: 100, s: 0, reaction: {text: "æ—¥æ›†æ›å¥½äº†ï¼Œæº–å‚™é–‹å§‹æ‰“æ‹¼ï¼", speaker: "åº—é•·"} },
              wrong: { money: 0, s: 1, reaction: {text: "æ—¥æœŸå¥½åƒä¸å¤ªå°ï¼Œç®—äº†å…ˆä¸ç®¡å®ƒï¼Œé–‹å§‹æ‰“æ‹¼ï¼", speaker: "åº—é•·"} } },
            
            { type: "talk", speaker: "æ—ç™½", text: "(é–€å£é€ä¾†ä¸€å¤§ç®±ä¹–ä¹–é€²è²¨äº†ï¼Œå †å¾—äº‚ä¸ƒå…«ç³Ÿã€‚)" },
            { type: "talk", speaker: "åº—é•·", text: "ä¹–ä¹–é€²è²¨äº†ï¼Œä½†å †å¾—äº‚ä¸ƒå…«ç³Ÿã€‚ä»¥å‰æˆ‘æœ€å–œæ­¡æ“ºæ•´é½Šäº†...", char: null },
            { type: "choice", text: "æ‚¨ç¾åœ¨çš„æƒ³æ³•æ˜¯ï¼Ÿ", qId: "Q2_Interest", choices: [
                { t: "å†ç´¯ä¹Ÿè¦å¥½å¥½æ•´ç†ä¸€ä¸‹ï¼Œç”Ÿæ„æ‰æœƒå¥½", s: 0, money: 200, reaction: {text: "å¥½ï¼Œæ•´ç†å®Œäº†ï¼Œçœ‹è‘—æ•´é½Šå¿ƒè£¡å°±èˆ’æœã€‚", speaker: "åº—é•·"} },
                { t: "å¥½ç´¯å–”ï¼Œå·æ‡¶ä¸€ä¸‹ï¼Œç”Ÿæ„ä¸æœƒå·®å¤šå°‘", s: 1, money: 0, reaction: {text: "å”‰ï¼ŒçœŸçš„å¤ªç´¯äº†ï¼Œå…ˆå°±é€™æ¨£éš¨ä¾¿æ”¾å§ã€‚", speaker: "åº—é•·"} }
            ], char: null },

            { type: "talk", speaker: "æ—ç™½", text: "(éˆ´éˆ´éˆ´â€”â€” æ«ƒå°çš„ç´…è‰²é›»è©±éŸ¿äº†)", char: "char_phone" },
            { type: "talk", speaker: "è‚‰è²©å°åŠ‰", text: "ã€è€é—†å¥½ï¼Œæˆ‘æ˜¯è‚‰è²©å°åŠ‰ï¼Œæˆ‘å€‘æœ‰é€²å£é«˜ç´šæ¾³æ´²ç‰›è‚‰è¶…ä¾¿å®œï¼ã€", char: "char_phone" },
            { type: "talk", speaker: "è‚‰è²©å°åŠ‰", text: "ã€å¤–é¢1æ–¤è¦ä¸€åƒå…ƒï¼Œæˆ‘é€™é‚Šåªè¦è³£ä¸€ç™¾å…ƒï¼Œè¦ä¸è¦å…ˆåŒ¯éŒ¢çµ¦æˆ‘ï¼Ÿã€", char: "char_phone" },
            { type: "choice", text: "æ‚¨çš„åæ‡‰æ˜¯ï¼Ÿ", qId: "Q3_Judgment", choices: [
                { t: "å¥½åƒå¾ˆåˆ’ç®—ï¼é¦¬ä¸ŠåŒ¯æ¬¾ã€‚", s: 1, money: -500, reaction: {text: "å¥½ï¼ŒåŒ¯éå»äº†ï¼æœŸå¾…ç‰›è‚‰... ä¸éå¿ƒè£¡æ€éº¼æ€ªæ€ªçš„ï¼Ÿ", speaker: "åº—é•·"} },
                { t: "è½èµ·ä¾†æ˜¯è©é¨™ï¼Œç›´æ¥æ›æ–·ã€‚", s: 0, money: 500, reaction: {text: "å‘¼... çœŸçš„è¦å°å¿ƒï¼Œé€™çµ•å°æ˜¯è©é¨™ï¼Œä¸èƒ½ä¸Šç•¶ã€‚", speaker: "åº—é•·"} }
            ], char: "char_phone" },
            
            { type: "talk", speaker: "æ—ç™½", text: "(éˆ´éˆ´éˆ´â€”â€” é›»è©±åˆéŸ¿äº†)", char: "char_phone" },
            { type: "talk", speaker: "ç±³åº—é˜¿å¼·", text: "ã€å–‚ï¼Ÿè€é—†å–”ï¼Œæˆ‘æ˜¯ç±³åº—é˜¿å¼·å•¦ï¼ä¸‹åˆ 4 é»æˆ‘æœƒéå»é€è²¨ï¼Œå…ˆè·Ÿä½ è¬›ä¸€è²ï¼ã€", char: "char_phone" },
            { type: "talk", speaker: "åº—é•·", text: "å¥½ï¼Œä¸‹åˆ 4 é»ï¼Œæˆ‘è¨˜ä½äº†ã€‚", char: "char_phone" },

            { type: "scene", bg: "bg_morning", time: "10:00" },
            { type: "talk", speaker: "æ—ç™½", text: "(éš”å£çš„è€ç‹æ–è‘—æ‰‡å­èµ°äº†é€²ä¾†)", char: "char_oldman" }, 
            { type: "talk", speaker: "è€ç‹", text: "åº—é•·æ—©å•Šï¼æ˜¨å¤©å¤©æ°£å¥½ï¼Œæˆ‘å»å…¬åœ’æ‰“äº†ä¸€å¥—å¤ªæ¥µæ‹³å–”ï¼", char: "char_oldman" },
            { type: "talk", speaker: "è€ç‹", text: "å˜¿å•Šï¼Œé‚„é‡åˆ°é™³åª½åª½ï¼ŒèŠäº†å¾ˆå¤šã€‚", char: "char_oldman" },
            { type: "choice", text: "æ‚¨æƒ³æ¥è‘—å•è€ç‹ä»€éº¼ï¼Ÿ", qId: "Q4_Memory_Short", choices: [
                { t: "é‚£å…¬åœ’æœ‰ä»€éº¼æ–°è®ŠåŒ–å—ï¼Ÿ", s: 0, money: 100, reaction: {text: "å“ˆå“ˆï¼Œå°±é‚£æ¨£å•¦ã€‚é‚£æˆ‘å…ˆèµ°äº†ï¼Œæ°æ°ï¼", speaker: "è€ç‹"} },
                { t: "æ˜¨å¤©ä½ å»å“ªè£¡é‹å‹•å•Šï¼Ÿ", s: 1, money: 0, reaction: {text: "å°±èªªå»å…¬åœ’æ‰“å¤ªæ¥µæ‹³å•Šï¼Œä½ å¿˜äº†å–”ï¼Ÿé‚£æˆ‘èµ°äº†ï¼Œæ°æ°ï¼", speaker: "è€ç‹"} }
            ], char: "char_oldman" }, 
            { type: "talk", speaker: "æ—ç™½", text: "(è€ç‹æ®æ®æ‰‹é›¢é–‹äº†)", char: null }, 

            { type: "scene", bg: "bg_noon", time: "12:00" },
            { type: "talk", speaker: "æ—ç™½", text: "(æ­£åˆæ™‚åˆ†ï¼Œåº—è£¡æ²’ä»€éº¼å®¢äººï¼Œåº—é•·åä¸‹ä¾†æƒ³çœ‹å€‹é›»è¦–ä¼‘æ¯ã€‚)" },
            { type: "talk", speaker: "åº—é•·", text: "ä¸­åˆä¼‘æ¯çœ‹ä¸€ä¸‹æ–°èå¥½äº†... å“å‘€ï¼", char: "char_tv", object: true },
            { type: "talk", speaker: "æ—ç™½", text: "(é›»è¦–ç•«é¢è®Šæˆäº†é›ªèŠ±é›œè¨Š)", char: "char_tv", object: true },
            { type: "choice", text: "é€šå¸¸æ‚¨æœƒæ€éº¼åšï¼Ÿ", qId: "Q5_Tool_Usage", choices: [
                { t: "æª¢æŸ¥è¨Šè™Ÿç·šæ¥é ­", s: 0, money: 150, reaction: {text: "ä¿®å¥½äº†ï¼æœç„¶æ˜¯è¨Šè™Ÿç·šé¬†äº†ã€‚", speaker: "åº—é•·"} },
                { t: "ä½¿ç”¨é™æ§å™¨é—œé›»è¦–", s: 1, money: 0, reaction: {text: "å”‰å”·ï¼Œæ€éº¼æŠŠé›»è¦–é—œäº†ï¼Œæ‡‰è©²è¦æª¢æŸ¥è¨Šè™Ÿç·š...", speaker: "åº—é•·"} } // ä¿®æ”¹ç¬¬5é¡Œé¸é …èˆ‡å°è©
            ], char: "char_tv", object: true }, 

            { type: "talk", speaker: "æ—ç™½", text: "(æ­£åˆå‰›éï¼Œé€™æ™‚é™³å¤ªå¤ªæè‘—ç±ƒå­é€²åº—äº†...)" },
            { type: "talk", speaker: "é™³å¤ªå¤ª", text: "è€é—†çµå¸³ï¼æˆ‘è¦è²·é€™äº›é†¬æ²¹å’Œç³–ã€‚", char: "char_customer" },
            { type: "talk", speaker: "åº—é•·", text: "å¥½ï¼Œä¸€å…±æ˜¯ 345 å…ƒã€‚", char: "char_customer" },
            { type: "talk", speaker: "æ—ç™½", text: "(é™³å¤ªå¤ªéçµ¦æ‚¨ä¸€å¼µ 1000 å…ƒå¤§éˆ”ï¼Œç­‰æ‚¨æ‰¾éŒ¢ã€‚)", char: "char_customer" }, 
            { type: "number_input", text: "è«‹å•è¦æ‰¾å¤šå°‘éŒ¢ï¼Ÿ", answer: 655, qId: "Q6_Calculation",
              correct: { s: 0, money: 345, reaction: {text: "ç®—å¾—æ²’éŒ¯ï¼Œè¬è¬è€é—†ï¼", speaker: "é™³å¤ªå¤ª"} },
              wrong: { s: 1, money: 0, reaction: {text: "å“å‘€æˆ‘è¶•è‘—å›å®¶ç…®é£¯ï¼Œæ²’ç´°çœ‹å•¦ï¼è¬å•¦è€é—†ï¼", speaker: "é™³å¤ªå¤ª"} },
              char: "char_customer" },
            { type: "talk", speaker: "æ—ç™½", text: "(é™³å¤ªå¤ªé–‹å¿ƒåœ°æè‘—é†¬æ²¹å›å®¶ç…®é£¯äº†)", char: null }, 

            { type: "scene", bg: "bg_evening", time: "16:00" },
            { type: "talk", speaker: "æ—ç™½", text: "(å¿«åˆ°ç´„å®šçš„æ™‚é–“ï¼Œé€™æ™‚ç±³åº—é˜¿å¼·è¼‰è‘—å¹¾å¤§è¢‹ç±³åˆ°äº†...)" },
            { type: "talk", speaker: "ç±³åº—é˜¿å¼·", text: "è€é—†ï¼æˆ‘ä¾†é€ç±³äº†ï¼è«‹å•æˆ‘å€‘æ—©ä¸Šç´„å¹¾é»ï¼Ÿ", char: "char_delivery" },
            { type: "time_picker", text: "æ—©ä¸Šç´„å®šçš„æ™‚é–“æ˜¯ï¼Ÿ", answer: [16], qId: "Q7_Memory_Long",
              correct: { s: 0, money: 100, reaction: {text: "æ²’éŒ¯ï¼è€é—†è¨˜æ€§çœŸå¥½ï¼Œå‰›å¥½ 4 é»æ•´ã€‚", speaker: "ç±³åº—é˜¿å¼·"} },
              wrong: { s: 1, money: 0, reaction: {text: "è€é—†... æˆ‘å€‘æ˜¯ç´„ä¸‹åˆ 4 é»æï¼Œç¾åœ¨éƒ½åˆ°äº†ï¼Œä½ è¨˜éŒ¯äº†å§ï¼Ÿ", speaker: "ç±³åº—é˜¿å¼·"} },
              char: "char_delivery" }, 
            { type: "talk", speaker: "æ—ç™½", text: "(ç±³åº—é˜¿å¼·å¸å®Œè²¨é›¢é–‹äº†)", char: null }, 

            { type: "scene", bg: "bg_night", time: "18:00" },
            { type: "talk", speaker: "åº—é•·", text: "å¤©é»‘äº†ï¼Œè©²æ‹‰éµé–€ä¼‘æ¯äº†ã€‚" },
            { type: "scene", bg: "bg_desktop", time: "18:00" },
            { type: "talk", speaker: "åº—é•·", text: "ç³Ÿç³•ï¼Œæ‰‹ä¸Šçš„é‘°åŒ™ä¸²ä¸çŸ¥é“æ”¾å“ªå»äº†ï¼Ÿ" },
            { type: "choice", text: "è«‹é¸æ“‡å°‹æ‰¾å€åŸŸï¼š", qId: "Q8_Orientation", choices: [
                { t: "å»æ«ƒå°æ¡Œé¢æ‰¾æ‰¾çœ‹", s: 0, money: 200, key: true },
                { t: "å»å†°ç®±è£¡é¢æ‰¾æ‰¾çœ‹", s: 1, money: 0 }
            ] },
            { type: "key_search", text: "æ‰¾åˆ°äº†ï¼åŸä¾†å£“åœ¨æ–‡ä»¶ä¸‹é¢ã€‚", char: null },
            { type: "end" }
        ];

        // ================= æ ¸å¿ƒé‚è¼¯ =================
        let index = 0, riskScore = 0, totalMoney = 0;
        let activeCharIndex = 1;
        let typeWriterTimer = null;
        let isMusicOn = true;
        let blockAdvance = false; 
        let speechSynth = window.speechSynthesis;

        const dom = {
            bg: document.getElementById('bg-layer'),
            char1: document.getElementById('char-1'),
            char2: document.getElementById('char-2'),
            overlay: document.getElementById('interaction-overlay'),
            titleText: document.getElementById('title-text'),
            content: document.getElementById('interaction-content'),
            dialog: document.getElementById('dialog-area'),
            speakerName: document.getElementById('speaker-name'),
            text: document.getElementById('dialog-text'),
            hudTime: document.getElementById('game-time'),
            hudMoney: document.getElementById('game-money'),
            key: document.getElementById('key-item'),
            startBtn: document.getElementById('start-btn'),
            bgm: document.getElementById('bgMusic'),
            userName: document.getElementById('user-name'),
            userAge: document.getElementById('user-age')
        };

        function toggleMusic() {
            isMusicOn = !isMusicOn;
            const icon = document.querySelector('#music-toggle i');
            if (isMusicOn) { icon.className = 'fas fa-volume-up'; dom.bgm.play().catch(e=>{}); } 
            else { icon.className = 'fas fa-volume-mute'; dom.bgm.pause(); speechSynth.cancel(); }
        }

        function speak(text, role) {
            if (!isMusicOn) return; 
            speechSynth.cancel(); 
            // ä¿®æ”¹ï¼šéæ¿¾æ‰æ‹¬è™Ÿèˆ‡ä¸å¿…è¦çš„ç¬¦è™Ÿï¼Œé˜²æ­¢è¢«æœ—è®€å‡ºä¾†
            const cleanText = text.replace(/[()ï¼ˆï¼‰ã€ã€ã€Œã€]/g, '');
            const u = new SpeechSynthesisUtterance(cleanText);
            u.lang = 'zh-TW';
            const profile = VOICE_PROFILES[role] || { pitch: 1.0, rate: 1.0 };
            u.pitch = profile.pitch; u.rate = profile.rate;
            speechSynth.speak(u);
        }

        function replayVoice() {
            const scene = SCRIPT[index];
            if(scene && scene.text) speak(scene.text, scene.speaker);
        }

        function speakTitle() {
            const scene = SCRIPT[index];
            if(scene && scene.text) speak(scene.text, "æ—ç™½");
        }

        window.onload = function() {
            resizeApp(); 
            let loadedCount = 0;
            const assetKeys = Object.keys(ASSETS);
            const checkProgress = () => {
                loadedCount++;
                const percent = Math.floor((loadedCount / assetKeys.length) * 100);
                dom.startBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> éŠæˆ²è¼‰å…¥ä¸­ (${percent}%)`;
                if (loadedCount >= assetKeys.length) { dom.startBtn.innerHTML = "é–‹å§‹ç‡Ÿæ¥­"; dom.startBtn.disabled = false; dom.startBtn.style.opacity = "1"; }
            };
            assetKeys.forEach(key => {
                const img = new Image();
                img.onload = checkProgress; img.onerror = checkProgress; img.src = ASSETS[key];
            });
            dom.bgm.load();
        };

        function startGame() { 
            const name = dom.userName.value.trim();
            const age = dom.userAge.value.trim();
            
            if (!name || !age) {
                alert("è«‹è¼¸å…¥å§“åèˆ‡å¹´é½¡æ‰èƒ½é–‹å§‹å–”ï¼");
                return;
            }

            userData.name = name;
            userData.age = parseInt(age);
            userData.startTime = new Date();

            document.getElementById('intro-overlay').style.display = 'none'; 
            render(); 
            
            // ä¿®æ”¹ï¼šæ‹”é™¤åŸæœ¬æ·¡å…¥æ©Ÿåˆ¶ï¼Œç¢ºä¿éŸ³æ¨‚ä¸€é–‹å§‹å°±æ»¿éŸ³é‡æ’­æ”¾ï¼Œä¸¦å¢åŠ éŒ¯èª¤æ’é™¤
            if(isMusicOn){ 
                dom.bgm.volume = 1.0; 
                dom.bgm.play().catch(e => console.error("éŸ³æ¨‚æ’­æ”¾è¢«é˜»æ“‹", e)); 
            } 
        }

        function render() {
            const scene = SCRIPT[index];
            if (!scene) return;

            if (scene.type === "scene") {
                dom.bg.style.backgroundImage = `url('${ASSETS[scene.bg]}')`;
                dom.hudTime.innerText = scene.time;
                dom.char1.classList.remove('char-visible'); dom.char2.classList.remove('char-visible');
                index++; render(); return;
            }

            if (scene.type === "end") { showReport(); return; }

            if (scene.type === "key_search") {
                dom.overlay.style.display = 'none';
                dom.speakerName.innerText = "ç³»çµ±æç¤º";
                typeWriter("è«‹åœ¨ç•«é¢ä¸Šå°‹æ‰¾é‘°åŒ™...", dom.text);
                dom.key.style.display = 'block';
                dom.key.onclick = () => {
                    dom.key.style.display = 'none';
                    dom.speakerName.innerText = "åº—é•·";
                    typeWriter(scene.text, dom.text, () => {
                        speak(scene.text, "åº—é•·");
                        setTimeout(() => { index++; render(); }, 2000);
                    });
                };
                return;
            }

            updateCharacter(scene);

            if (scene.type === 'choice') showChoice(scene);
            else if (scene.type === 'date_input') showDateInput(scene);
            else if (scene.type === 'number_input') showNumberInput(scene);
            else if (scene.type === 'time_picker') showTimePicker(scene); 
            else showTalk(scene);
        }

        function updateCharacter(scene) {
            const activeEl = activeCharIndex === 1 ? dom.char1 : dom.char2;
            const nextEl = activeCharIndex === 1 ? dom.char2 : dom.char1;
            if (scene.char && ASSETS[scene.char]) {
                const targetSrc = ASSETS[scene.char];
                if (!activeEl.src.includes(targetSrc) || !activeEl.classList.contains('char-visible')) {
                    nextEl.className = 'char-img';
                    if (scene.char === 'char_clock') nextEl.classList.add('calendar-pos');
                    else if (scene.char === 'char_phone') nextEl.classList.add('phone-pos');
                    else if (scene.object) nextEl.classList.add('object-mode');
                    nextEl.src = targetSrc;
                    nextEl.onload = () => { nextEl.classList.add('char-visible'); activeEl.classList.remove('char-visible'); activeCharIndex = activeCharIndex === 1 ? 2 : 1; };
                }
            } else { dom.char1.classList.remove('char-visible'); dom.char2.classList.remove('char-visible'); }
        }

        function typeWriter(t, el, cb) { 
            if (typeWriterTimer) clearInterval(typeWriterTimer); 
            el.innerText = ""; let i = 0; 
            typeWriterTimer = setInterval(() => { 
                el.innerText += t.charAt(i); i++; 
                if (i >= t.length) { clearInterval(typeWriterTimer); typeWriterTimer = null; if (cb) cb(); } 
            }, 30); 
        }

        function showTalk(scene) { dom.overlay.style.display = 'none'; dom.speakerName.innerText = scene.speaker || "æ—ç™½"; typeWriter(scene.text, dom.text); speak(scene.text, scene.speaker || "æ—ç™½"); }

        function showChoice(scene) {
            dom.overlay.style.display = 'flex'; dom.titleText.innerText = scene.text; dom.content.innerHTML = "";
            speak(scene.text, "æ—ç™½"); 
            scene.choices.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                
                btn.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <div class="opt-speak-btn" onclick="event.stopPropagation(); speak('${opt.t}', 'æ—ç™½')">
                            <i class="fas fa-volume-up"></i>
                        </div>
                        <span style="text-align:left;">${opt.t}</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>`;
                
                btn.onclick = () => processResult({ s: opt.s, money: opt.money, reaction: opt.reaction }, opt.key, scene.qId, opt.t);
                dom.content.appendChild(btn);
            });
        }

        function showDateInput(scene) {
            dom.overlay.style.display = 'flex'; dom.titleText.innerText = scene.text; speak(scene.text, "æ—ç™½"); 
            dom.content.innerHTML = `<div class="input-group">
                <select id="yy_sel" class="custom-select"><option value="">å¹´ä»½</option></select>
                <select id="mm_sel" class="custom-select"><option value="">æœˆä»½</option></select>
                <select id="dd_sel" class="custom-select"><option value="">æ—¥æœŸ</option></select>
            </div><button class="confirm-btn" onclick="checkDateHandler()">ç¢ºèª</button>`;
            const yy = document.getElementById('yy_sel'), mm = document.getElementById('mm_sel'), dd = document.getElementById('dd_sel');
            const now = new Date();
            for(let yr=now.getFullYear()-1; yr<=now.getFullYear()+1; yr++) yy.innerHTML += `<option value="${yr}">${yr-1911} å¹´</option>`;
            for(let i=1; i<=12; i++) mm.innerHTML += `<option value="${i-1}">${i} æœˆ</option>`;
            for(let i=1; i<=31; i++) dd.innerHTML += `<option value="${i}">${i} æ—¥</option>`;
            window.checkDateHandler = () => {
                const sY = parseInt(document.getElementById('yy_sel').value);
                const sM = parseInt(document.getElementById('mm_sel').value);
                const sD = parseInt(document.getElementById('dd_sel').value);
                if(isNaN(sY) || isNaN(sM) || isNaN(sD)) return;
                const isCorrect = (sY === now.getFullYear() && sM === now.getMonth() && sD === now.getDate());
                handleResult(isCorrect, scene, `Input: ${sY}/${sM+1}/${sD}`);
            };
        }

        function showNumberInput(scene) {
            dom.overlay.style.display = 'flex'; dom.titleText.innerText = scene.text; speak(scene.text, "æ—ç™½"); 
            dom.content.innerHTML = `<div id="numpad-display"></div><div id="numpad">
                ${[1,2,3,4,5,6,7,8,9].map(n => `<button class="num-btn" onclick="addNum(${n})">${n}</button>`).join('')}
                <button class="num-btn" style="color:#fc8181" onclick="clearNum()">C</button>
                <button class="num-btn" onclick="addNum(0)">0</button>
                <button class="num-btn del-btn" onclick="backspace()"><i class="fas fa-backspace"></i></button>
                <button class="num-btn ok-btn" style="grid-column: span 3; background:#48bb78; color:white; font-size:20px; margin-top:10px;" onclick="checkNum()">ç¢ºèªé€å‡º</button>
            </div>`;
            let val = ""; const display = document.getElementById('numpad-display');
            window.addNum = (n) => { if (val === "" && n === 0) return; if(val.length<5) val+=n; display.innerText = val; };
            window.clearNum = () => { val=""; display.innerText = ""; };
            window.backspace = () => { val = val.slice(0, -1); display.innerText = val; };
            window.checkNum = () => { if(val==="") return; handleResult(parseInt(val) === scene.answer, scene, `Input: ${val}`); };
        }

        function showTimePicker(scene) {
            dom.overlay.style.display = 'flex'; dom.titleText.innerText = scene.text; speak(scene.text, "æ—ç™½"); 
            dom.content.innerHTML = `<div class="time-picker-container"><div class="ampm-toggle">
                <button class="ampm-btn active" id="btn-am" onclick="setAmPm('AM')">ä¸Šåˆ</button>
                <button class="ampm-btn" id="btn-pm" onclick="setAmPm('PM')">ä¸‹åˆ</button>
            </div><div class="hour-selector">${[1,2,3,4,5,6,7,8,9,10,11,12].map(h => `<div class="hour-btn" onclick="selectHour(${h}, this)">${h}</div>`).join('')}</div></div><button class="confirm-btn" onclick="checkTimePicker()">ç¢ºèª</button>`;
            let selectedPeriod = 'AM', selectedHour = null;
            window.setAmPm = (p) => { selectedPeriod = p; document.getElementById('btn-am').className = p==='AM' ? 'ampm-btn active' : 'ampm-btn'; document.getElementById('btn-pm').className = p==='PM' ? 'ampm-btn active' : 'ampm-btn'; };
            window.selectHour = (h, el) => { selectedHour = h; document.querySelectorAll('.hour-btn').forEach(b => b.classList.remove('selected')); el.classList.add('selected'); };
            window.checkTimePicker = () => { if(selectedHour === null) return; let finalH = selectedHour; if(selectedPeriod === 'PM' && selectedHour !== 12) finalH += 12; if(selectedPeriod === 'AM' && selectedHour === 12) finalH = 0; handleResult(finalH === 16, scene, `Input: ${selectedPeriod} ${selectedHour}`); };
        }

        function handleResult(isCorrect, scene, userChoiceText) { 
            const outcome = isCorrect ? scene.correct : scene.wrong;
            processResult(outcome, false, scene.qId, userChoiceText || (isCorrect ? "Correct" : "Wrong")); 
        }

        function processResult(data, isKeyTask, qId, choiceText) {
            riskScore += (data.s || 0); totalMoney += (data.money || 0); dom.hudMoney.innerText = totalMoney; dom.overlay.style.display = 'none'; 
            
            if (qId) {
                userData.logs.push({
                    questionId: qId,
                    result: data.s === 0 ? "PASS" : "FAIL", 
                    choice: choiceText,
                    timestamp: new Date()
                });
            }

            if (data.reaction) {
                blockAdvance = true; 
                dom.speakerName.innerText = data.reaction.speaker; dom.dialog.style.display = 'flex'; 
                typeWriter(data.reaction.text, dom.text, () => waitForClick()); speak(data.reaction.text, data.reaction.speaker); 
            } else {
                index++;
                if (SCRIPT[index] && SCRIPT[index].type === 'key_search' && !isKeyTask) index++;
                render();
            }
        }

        function advanceStory() {
            if (dom.overlay.style.display === 'flex' || dom.key.style.display === 'block' || blockAdvance) return;
            if (typeWriterTimer) { clearInterval(typeWriterTimer); typeWriterTimer = null; dom.text.innerText = SCRIPT[index].text || ""; return; }
            index++; if (index < SCRIPT.length) render();
        }

        function waitForClick() { 
            const h = () => { 
                dom.dialog.removeEventListener('click', h); 
                blockAdvance = false; 
                index++; render(); 
            }; 
            setTimeout(() => dom.dialog.addEventListener('click', h), 500); 
        }

        function resizeApp() { document.getElementById('mobile-container').style.height = `${window.innerHeight}px`; }
        window.addEventListener('resize', resizeApp);

        function showReport() {
            document.getElementById('report-overlay').style.display = 'flex';
            document.getElementById('report-money').innerText = `$${totalMoney}`;
            const stamp = document.getElementById('final-stamp');
            const advice = document.getElementById('report-advice');
            let rankText = "", adviceContent = "";
            if (riskScore <= 1) { rankText = "é‡‘ç‰Œåº—é•·"; adviceContent = "å¤ªå²å®³äº†ï¼æ‚¨çš„è¨˜æ†¶åŠ›èˆ‡åˆ¤æ–·åŠ›éƒ½éå¸¸æ¸…æ™°ï¼Œè«‹ç¹¼çºŒä¿æŒï¼"; } 
            else if (riskScore <= 3) { rankText = "éŠ€ç‰Œåº—é•·"; adviceContent = "è¡¨ç¾ä¸éŒ¯å–”ï¼å¤šå‹•è…¦ã€å¤šé‹å‹•å¯ä»¥è®“é ­è…¦æ›´éˆæ´»ã€‚"; } 
            else { rankText = "éŠ…ç‰Œåº—é•·"; adviceContent = "æœ€è¿‘æ˜¯ä¸æ˜¯æ¯”è¼ƒç´¯å‘¢ï¼Ÿå»ºè­°æ‰¾æ™‚é–“æ‰¾é†«ç”Ÿæª¢æŸ¥ä¸€ä¸‹å–”ï¼Œä¿é¤Šä¸€ä¸‹å¤§è…¦ã€‚"; }
            stamp.innerText = rankText; advice.innerText = adviceContent;
            speak("ä»Šæ—¥ç‡Ÿæ¥­çµæŸã€‚æ‚¨çš„è©•ç´šæ˜¯ï¼š" + rankText + "ã€‚" + adviceContent, "æ—ç™½");
            
            saveGameRecord(riskScore, totalMoney);
        }
    </script>
</body>
</html>